# Managing Repeating Jobs by Using Systemd Timer Units
---

## Systemd Timer

Starting from Red Hat Enterprise Linux 10, the `systemd` daemon and service manager replaces the traditional `cron` daemon for most of the scheduling system tasks, via the `systemd` timer units.

A `systemd` timer unit is defined by a unit configuration file with a file name that ends with `.timer.` Timer units activate a unit of another type, which is usually a service. By default, the unit name matches the timer unit name. Timer units enable timer-based activation of other units and describe when to run another unit. The `systemd` timer unit logs timer events in system journals for ease of debugging.

Note

    Fuller discussion of the systemd timer units is beyond the scope of this section. For more information, see the systemd(1) man page.

## List Timer Units

To list all timer units that are loaded in memory, use the `systemctl list-units` command. This command lists timer units that are active, pending, or failed. You can use the `--all` option to include inactive timer units.

```bash
systemctl list-units -t timer
```
```bash
  UNIT                         LOAD   ACTIVE SUB     DESCRIPTION
  dnf-makecache.timer          loaded active waiting dnf makecache --timer
  fstrim.timer                 loaded active waiting Discard unused ...
  fwupd-refresh.timer          loaded active waiting Refresh fwupd ...
  logrotate.timer              loaded active waiting Daily rotation ...
  plocate-updatedb.timer       loaded active waiting Update the plocate ...
  raid-check.timer             loaded active waiting Weekly RAID setup ...
  systemd-tmpfiles-clean.timer loaded active waiting Daily Cleanup ...
...output omitted...
```

The column headings are as follows:

**UNIT**
The full name of the unit.

**LOAD**
Indicates whether the unit definition was loaded.

**ACTIVE**
Indicates whether the unit is active at a high level.

**SUB**
Shows the unit-type-specific detailed state of the unit; possible values vary by unit type.

**DESCRIPTION**
A brief description of the unit's purpose.

## List Timer Unit Files

You can list all installed timer unit files with the `systemctl list-unit-files` command. In contrast to the `systemctl list-units` command, the `systemctl list-unit-files` command also includes unit templates.

```bash
systemctl list-unit-files -t timer
```

```bash
UNIT FILE                      STATE    PRESET
dnf-makecache.timer            enabled  enabled
fstrim.timer                   enabled  enabled
fwupd-refresh.timer            enabled  enabled
insights-client.timer          disabled disabled
logrotate.timer                enabled  enabled
mdadm-last-resort@.timer       static   -
mdcheck_continue.timer         disabled disabled
mdcheck_start.timer            disabled disabled
mdmonitor-oneshot.timer        disabled disabled
plocate-updatedb.timer         enabled  enabled
podman-auto-update.timer       disabled disabled
raid-check.timer               enabled  enabled
rhc-canonical-facts.timer      disabled disabled
systemd-sysupdate-reboot.timer disabled disabled
systemd-sysupdate.timer        disabled disabled
systemd-tmpfiles-clean.timer   static   
```

The column headings are as follows:

**UNIT FILE**
The full name of the unit file.

**STATE**
Indicates the current enablement state of the unit.

**PRESET**
Indicates whether the unit is enabled by default.

## Start and Stop Systemd Timer Units

Use the `systemctl start` command to start a timer unit. To start the log rotation timer unit named logrotate, use the following command:

```bash
systemctl start logrotate.timer
```

Use the `systemctl stop` command to stop a timer unit. To stop the log rotation timer unit named logrotate, use the following command:

```bash
systemctl stop logrotate.timer
```

## Enable and Disable Systemd Timer Units

Use the `systemctl enable` command to enable a `systemd` timer unit at system boot time. To enable the log rotation timer unit named logrotate, use the following command:

```bash
systemctl enable logrotate.timer
```

The `systemctl enable` command alone does not start the systemd unit. To enable and start the systemd unit in one step, include the `--now` switch:

```bash
systemctl enable --now logrotate.timer
```

Use the `systemctl disable` command to disable a timer unit at system boot time. To disable the log rotation timer unit named `logrotate`, use the following command:

```bash
systemctl disable logrotate.timer
```

The `systemctl disable` command alone does not stop the systemd unit. To disable and stop the systemd unit in one step, include the `--now` switch:

```bash
systemctl disable --now logrotate.timer
```

## Timer Unit Status

You can use the `systemctl status` command to display the current status of a timer unit and its corresponding service unit.

To show the current status of the logrotate timer and service units, use the following command:

```bash
systemctl status logrotate.timer
```

## Example Timer Unit Configuration File

The sysstat package provides the systemd timer unit, which is the `sysstat-collect.timer` service, to collect system statistics every 10 minutes.

The following output shows the contents of the `/usr/lib/systemd/system/sysstat-collect.timer` configuration file:

```bash
...output omitted...
[Unit]
Description=Run system activity accounting tool every 10 minutes

[Timer]
OnCalendar=*:00/10

[Install]
WantedBy=sysstat.service
```

The [Unit] and [Install] sections contain configuration items that are common to all the systemd units. The timer-specific options are defined in the [Timer] section.

In this example, the `OnCalendar=*:00/10` option signifies that this timer unit activates the corresponding `sysstat-collect.servic`e service unit every 10 minutes.

You can specify more complex time intervals. For example, when the OnCalendar option is set to a value of 2025-07-* 12:35,37,39:16, the timer unit activates the corresponding service unit at the 12:35:16, 12:37:16, and 12:39:16 times, on every day of July 2025.

You can also specify relative timers by using the `OnUnitActiveSec` option. For example, when the `OnUnitActiveSec` option is set to a value of 15min, the timer unit triggers the corresponding service unit to start 15 minutes after the last time that the service unit was activated.

For more information about timer unit options, refer to the `systemd.timer(5)` man page.

Important

    Do not modify any unit configuration files in the `/usr/lib/systemd/system` directory. The systemd unit overrides all configuration changes that are made in the `/usr/lib/systemd/system` directory. To modify a systemd unit's configuration, copy its unit configuration file from the `/usr/lib/systemd/system` directory to the `/etc/systemd/system` directory, and then modify the copied file to prevent any update to the provider package from overriding the changes. If two files exist with the same name in the `/usr/lib/systemd/system` and `/etc/systemd/system` directories, then the systemd timer unit parses the file in the `/etc/systemd/system` directory.

After you change the timer unit configuration file, use the `systemctl daemon-reload` command to ensure that the systemd timer unit loads the changes.

```bash
systemctl daemon-reload
```

After reloading the `systemd daemon` configuration, use the `systemctl` command to enable and immediately activate the timer unit.

```bash
systemctl enable --now UNITNAME.timer
```

---
# Managing Temporary Files
---

## The Systemd-tempfiles Tool

Most critical applications and services use temporary files and directories. Some applications and users use the /tmp directory to hold transient working data, whereas other applications use task-specific locations such as daemon- and user-specific volatile directories under the /run directory, which exist only in memory. When the system reboots or loses power, memory-based file systems are self-cleaning.

Commonly, daemons and scripts operate correctly only when their expected temporary files and directories exist. Additionally, purging temporary files on persistent storage is necessary to prevent disk space issues or stale working data.

Red Hat Enterprise Linux includes the `systemd-tmpfiles` tool, which provides a structured and configurable method to manage temporary directories and files.

At system boot, one of the first systemd service units to launch is the `systemd-tmpfiles-setup` service. This service runs the `systemd-tmpfiles` command, which reads instructions from the `/usr/lib/tmpfiles.d/*.conf`, `/run/tmpfiles.d/*.conf`, and `/etc/tmpfiles.d/*.conf` configuration files. These configuration files list files and directories that the systemd-tmpfiles-setup service is instructed to create, delete, or secure with permissions.

## Clean Temporary Files with a Systemd Timer

To prevent long-running systems from filling up their disks with stale data, a systemd timer unit named `systemd-tmpfiles-clean.timer` triggers at a regular interval the `systemd-tmpfiles-clean.service` unit, which executes the `systemd-tmpfiles --clean` command.

A systemd timer unit configuration has a [Timer] section to indicate how to start the service with the same name as the timer.

Use the following `systemctl` command to view the contents of the systemd-tmpfiles-clean.timer unit configuration file:

```bash
systemctl cat systemd-tmpfiles-clean.timer
```
```bash
# /usr/lib/systemd/system/systemd-tmpfiles-clean.timer
#  SPDX-License-Identifier: LGPL-2.1-or-later
#
#  This file is part of systemd.
...output omitted...

[Unit]
Description=Daily Cleanup of Temporary Directories
Documentation=man:tmpfiles.d(5) man:systemd-tmpfiles(8)
ConditionPathExists=!/etc/initrd-release

[Timer]
OnBootSec=15min
OnUnitActiveSec=1d
```

In the preceding configuration, the `OnBootSec=15min` parameter indicates that the `systemd-tmpfiles-clean.service` unit gets triggered 15 minutes after the system boots up. The `OnUnitActiveSec=1d` parameter indicates that any further trigger to the `systemd-tmpfiles-clean`.service unit happens 24 hours after the service unit was last activated.

Change the parameters in the `systemd-tmpfiles-clean.timer` unit configuration file to meet your requirements. For example, a 30min value for the OnUnitActiveSec parameter triggers the systemd-tmpfiles-clean.service unit 30 minutes after the service unit was last activated. As a result, the systemd-tmpfiles-clean.service unit gets triggered every 30 minutes after the changes are recognized.

After you change the timer unit configuration file, use the `systemctl daemon-reload` command to ensure that the systemd daemon loads the new configuration.

```bash
systemctl daemon-reload
```

You can view the status of the timer unit, including whether it is loaded in memory or active, by using the systemctl status command:

```bash
root@host:~# systemctl status systemd-tmpfiles-clean.timer
● systemd-tmpfiles-clean.timer - Daily Cleanup of Temporary Directories
     Loaded: loaded (/usr/lib/.../systemd-tmpfiles-clean.timer; static)
     Active: active (waiting) since Fri 2025-05-30 13:59:31 UTC; 19min ago
 Invocation: 497008f1a6594041812a660b64f3c550
    Trigger: Sat 2025-05-31 14:14:31 UTC; 23h left
   Triggers: ● systemd-tmpfiles-clean.service
       Docs: man:tmpfiles.d(5)
             man:systemd-tmpfiles(8)

May 30 13:59:31 host systemd[1]: Started systemd-tmpfiles-clean...
```

## Clean Temporary Files Manually

The `systemd-tmpfiles --clean` command parses the same configuration files as the `systemd-tmpfiles --create` command; instead of creating files and directories, it purges all files that were not accessed, changed, or modified more recently than the maximum age that is defined in the configuration file.

For detailed information about the format of the configuration files for the `systemd-tmpfiles` service, refer to the `tmpfiles.d(5)` man page.

The syntax consists of the following columns: `Type`, `Path`, `Mode`, `UID`, `GID`, `Age`, and `Argument`. Type refers to the action for the `systemd-tmpfiles` service to take; for example, the `d` option to create a directory if it does not exist, or the Z option to recursively restore SELinux contexts, file permissions, and ownership.

```bash
d /run/systemd/seats 0755 root root -
```

- Creates the /run/systemd/seats directory if it does not exist.
- If the directory exists, takes no action.
- Sets the root user and the root group as owners.
- Sets the file permissions to 0755 (rwxr-xr-x).
- Does not set an age or any additional arguments.
- The systemd-tmpfiles service does not purge this directory automatically.

The following example removes files from the `/home/student` directory that were not accessed, changed, or modified for more than one day:

```bash
D /home/student 0700 student student 1d
```
- Creates the /home/student directory if it does not exist.
- If the directory exists, then removes all its contents.
- Sets the student user and the student group as owners.
- Sets the file permissions to 0700 (rwx------).
- Sets the age to one day.
- Does not set any additional arguments.
- When the system runs the `systemd-tmpfiles --clean` command, all files that you did not access, change, or modify for more than one day are removed from the `/home/student` directory.

The following example creates a symbolic link to the `/etc/fstab` directory:

```bash
L /run/fstablink - root root - /etc/fstab
```

- Creates the `/run/fstablink` symbolic link to point to the `/etc/fstab` directory.
- Sets the root user and the root group as owners.
- Never automatically purges this line.
- Does not set the permissions or age.
- Sets the argument to `/etc/fstab` to indicate the source of the link.

## Configuration File Precedence

The `systemd-tmpfiles-clean` service configuration files can exist in three places:

- /etc/tmpfiles.d/*.conf
- /run/tmpfiles.d/*.conf
- /usr/lib/tmpfiles.d/*.conf

Use the files in the `/etc/tmpfiles.d/` directory to configure custom temporary locations, and to override vendor-provided defaults. The files in the `/run/tmpfiles.d/` directory are volatile files, which daemons normally use to manage their own runtime temporary files. Relevant RPM packages provide the files in the `/usr/lib/tmpfiles.d/` directory; therefore do not edit these files.

If a file in the `/run/tmpfiles.d/` directory has the same file name as a file in the `/usr/lib/tmpfiles.d/` directory, then the service uses the file in the `/run/tmpfiles.d/` directory. If a file in the `/etc/tmpfiles.d/` directory has the same file name as a file in either the `/run/tmpfiles.d/` or the `/usr/lib/tmpfiles.d/` directories, then the service uses the file in the `/etc/tmpfiles.d/` directory.

Given these precedence rules, you can override vendor-provided settings by copying the relevant file to the `/etc/tmpfiles.d/` directory and editing it. By using these configuration locations correctly, you can manage administrator-configured settings from a central configuration management system, and package updates do not overwrite your configured settings.

Note

  When testing new or modified configurations, apply only the commands from a single configuration file at a time. Specify the name of the single configuration file on the systemd-tmpfiles command line.

---
# Scheduling Recurring System Tasks with Cron
---

## Recurring System Jobs

System administrators often need to run recurring jobs. It is best to run these jobs from system accounts rather than from user accounts. Schedule these jobs with system-wide crontab files instead of with the crontab command. Job entries in the system-wide crontab files are similar to the users' crontab entries. The system-wide crontab files have an extra field before the command field to specify the user that runs the command.

The `/etc/crontab` file has a syntax diagram in the comments.

```bash
SHELL=/bin/bash
PATH=/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=root

# For details see man 4 crontabs

# Example of job definition:
# .---------------- minute (0 - 59)
# |  .------------- hour (0 - 23)
# |  |  .---------- day of month (1 - 31)
# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...
# |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue...
# |  |  |  |  |
# *  *  *  *  * user-name  command to be executed
```

The `/etc/crontab` file and other files in the /etc/cron.d directory define the recurring system jobs. Always create custom crontab files in the `/etc/cron.d` directory to schedule recurring system jobs. Place the custom crontab file in the `/etc/cron.d` directory to prevent a package update from overwriting the `/etc/crontab` file. Packages that require recurring system jobs place their crontab files in the  `/etc/cron.d` directory with the job entries. Administrators also use this location to group related jobs into a single file.

The crontab system also includes repositories for scripts to run every hour, day, week, or month. These repositories are placed in the `/etc/cron.hourly`, `/etc/cron.daily`, `/etc/cron.weekly`, or `/etc/cron.monthly` directories. These directories contain executable shell scripts, not crontab files.

Note
  
  Use the chmod +x script_name command to make a script executable. A script must be executable to run.

## Default System Crontab Files

Every script in the `/etc/cron.hourly` directory is a job that is run via the `/etc/cron.d/0hourly` secondary system crontab file. This crontab file instructs the crond daemon to execute the run-parts command on the `/etc/cron.hourly` directory, as the root user, at one minute past every hour. The run-parts command runs every executable file it finds inside the directory.

```bash
cat /etc/cron.d/0hourly
```
```bash
# Run the hourly jobs
SHELL=/bin/bash
PATH=/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=root
01 * * * * root run-parts /etc/cron.hourly
```

## Creating a System Cron Job

To set up a system cron job, add a crontab file in the `/etc/cron.d` directory.

For example, the following crontab file named `/etc/cron.d/timestamp_example` appends a temporary file named `/tmp/timestamp_example.txt` with the output of the date command every two minutes.

```bash
# Example timestamp cronjob
SHELL=/bin/bash
PATH=/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=root
*/2 * * * * root date >> /tmp/timestamp_example.txt
```

The `*/2` notation indicates a step value of two. In the minute field, this notation is interpreted as "every two minutes".

After several minutes, the `/tmp/timestamp_example.txt` file shows evidence of the date command being executed every two minutes:

```bash
cat /tmp/timestamp_example.txt
```
```bash
Fri May 30 15:48:01 UTC 2025
Fri May 30 15:50:01 UTC 2025
Fri May 30 15:52:01 UTC 2025
Fri May 30 15:54:01 UTC 2025
...output omitted...
```

Important

  Apart from comments, the `/etc/crontab` file is otherwise empty by default. Never edit the `/etc/crontab` file directly; use this file solely as a reference. Place individual crontab files in the `/etc/cron.d` directory instead.

  System packages can also install related crontab files in the `/etc/cron.d` directory. To reduce the change of a file name collision, include a string in the crontab file name that uniquely identifies it.

## Run Periodic Commands with Anacron

The `anacron` command uses the run-parts script to execute daily, weekly, or monthly jobs from the `/etc/anacrontab` configuration file on a recurring basis. Also, the anacron command is responsible for running standardized system jobs on predefined schedules.

Whereas the `crond` daemon can run time-sensitive tasks in systems that are presumed to be always running, the anacron command ensures that scheduled jobs always run and are not skipped accidentally because the system was turned off or hibernated.

For example, when a system job that runs daily was not executed at a specified time because the system was rebooting, then the job is completed when the system becomes ready. A delay might occur before the job starts, if specified in the Delay in minutes parameter in the `/etc/anacrontab` file.

Files in the `/var/spool/anacron` directory determine the daily, weekly, or monthly jobs. When the crond daemon starts a job from the `/etc/anacrontab` file, it updates the timestamps of those files. With this timestamp, you can determine the last time that the job executed. The syntax of the `/etc/anacrontab` file is different from the regular crontab configuration files.

The `/etc/anacrontab` file contains four fields per line, as shown in the following example:

```bash
# /etc/anacrontab: configuration file for anacron

# See anacron(8) and anacrontab(5) for details.

SHELL=/bin/sh
PATH=/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=root
# the maximal random delay added to the base delay of the jobs
RANDOM_DELAY=45
# the jobs will be started during the following hours only
START_HOURS_RANGE=3-22

#period in days   delay in minutes   job-identifier   command
1       5       cron.daily              nice run-parts /etc/cron.daily
7       25      cron.weekly             nice run-parts /etc/cron.weekly
@monthly 45     cron.monthly            nice run-parts /etc/cron.monthly
```

**Period in days**
Defines the interval in days for the job to run on a recurring schedule. This field accepts an integer or a macro value. For example, the @daily macro is equivalent to the 1 integer, which executes the job daily. Similarly, the @weekly macro is equivalent to the 7 integer, which executes the job weekly.

**Delay in minutes**
Defines the time that the crond daemon must wait before it starts the job.

**Job identifier**
Identifies the unique name of the job in the log messages.

**Command**
The command to be executed.

The `/etc/anacrontab` file also contains environment variable declarations with the `NAME=value` syntax. The `START_HOURS_RANGE` variable specifies the time interval for the jobs to run. Jobs do not start outside this range. If a job does not run within this time interval on a particular day, then the job must wait until the next day for execution.

## Relationship Between Cron and Anacron

The `crond.service` command scheduler service and the `anacron` command work together as follows:

- Recall that the `/etc/cron.d` directory includes an 0hourly crontab file that, at one minute past every hour, executes the run-parts `/etc/cron.hourly` command as the root user.
- The `/etc/cron.hourly` directory contains a shell script named 0anacron that, in turn, conditionally runs the `/usr/sbin/anacron -s` command.
- When executed, the `/usr/sbin/anacron -s` command reads the `/etc/anacrontab` configuration file and executes the nice `run-parts` command on the `/etc/cron.daily`, `/etc/cron.weekly`, and `/etc/cron.monthly` files at particular time intervals, including a random delay of up to 45 minutes.



