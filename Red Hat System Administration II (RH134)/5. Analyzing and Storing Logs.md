# The System Log Architecture
---

## System Logging

The operating system kernel and other processes record a log of events that happen when the system is running. These logs are used to audit the system and to troubleshoot problems. You can use text utilities such as the `less` and `tail` commands to inspect these logs.

Red Hat Enterprise Linux uses a standard logging system that is based on the `syslog` protocol to log the system messages. Many programs use the logging system to record events and to organize them into log files. The `systemd-journald` and `rsyslog` services handle the `syslog` messages in Red Hat Enterprise Linux.

The `systemd-journald` service is at the heart of the operating system event logging architecture.

The `systemd-journald` service collects event messages from many sources:

- System Kernel
- Output from the early stages of the boot process.
- Standard output and standard error from daemons
- The `syslog` events.

The `systemd-journald` service restructures the logs into a standard format and writes them into a structured, indexed system journal. By default, this journal is stored on a file system that does not persist across reboots.

The `rsyslog` service reads the syslog messages that the `systemd-journald` service receives from the journal when they arrive. The `rsyslog` service then processes the `syslog` events, and records them to its log files or forwards them to other services according to its own configuration.

Note

    In RHEL 10, the operating system sends the local syslog messages to the `/dev/log` file, which is a symbolic link to a special socket file read by the `systemd-journald` service. Those messages are recorded to the system journal by the `systemd-journald` service.

    Meanwhile, the `rsyslog` service does not read the `/dev/log` file directly. Instead, the `rsyslog` service uses its `imjournal` module to read the syslog messages from the system journal as they arrive, and then saves those log messages into files based on the configuration files.

The `rsyslog` service sorts and writes the syslog messages to the log files that do persist across reboots in the `/var/log` directory. The `rsyslog` service also sorts the syslog messages to specific log files according to the type of program that sent each message and the priority of each message.

In addition to the syslog message files, the `/var/log` directory contains log files from other services on the system.

The following table lists some useful files in the `/var/log` directory:

**Selected System Log Files**

| Log file          | Type of stored messages                                                                                                                                              |
| ----------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| /var/log/messages | Most syslog messages are logged here. Exceptions include messages about authentication and email processing, scheduled job execution, and purely debugging-related messages. |
| /var/log/secure   | Messages about security and authentication events                                                                                                                   |
| /var/log/maillog  | Messages about the mail server                                                                                                                                       |
| /var/log/cron     | Messages about scheduled job execution                                                                                                                              |
| /var/log/boot.log | Console messages about system startup that are hidden by the graphical startup screen, and the syslog messages that are sent to the local7 facility.                 |


The boot log stored in the `/var/log/boot.log` file can be populated from two sources.

The splash screen, which the Plymouth application provides and that is displayed when the system starts, and hides many diagnostic messages by default. Plymouth dumps these diagnostic messages to the `/var/log/boot.log` file.

The `rsyslog` service also saves any log messages that is sent to its local7 facility (typically messages about the boot process) as a line in the same `/var/log/boot.log` file.

Some applications do not use the syslog service to manage their log messages. For example, the Apache HTTP Server saves log messages to files in a subdirectory of the `/var/log` directory.

---
# Interpreting and Managing Syslog Events
---

## Log Events to the System

Many programs use the `syslog` protocol to log events to the system. Each log message is categorized by facility (the subsystem that produces the message) and priority (the message's severity).

The following table lists the standard `syslog` facilities:

**Overview of Syslog Facilities**

| Code   | Facility       | Facility description                    |
| ------ | -------------- | --------------------------------------- |
| 0      | kern           | Kernel messages                         |
| 1      | user           | User-level messages                     |
| 2      | mail           | Mail system messages                    |
| 3      | daemon         | System daemon messages                  |
| 4      | auth           | Authentication and security messages    |
| 5      | syslog         | Internal syslog messages                |
| 6      | lpr            | Printer messages                        |
| 7      | news           | Network news messages                   |
| 8      | uucp           | UUCP protocol messages                  |
| 9      | cron           | Clock daemon messages                   |
| 10     | authpriv       | Nonsystem authorization messages        |
| 11     | ftp            | FTP protocol messages                   |
| 16-23 | local0 to local7 | Custom local messages                   |


The following table lists the standard syslog priorities in descending order:

**Overview of Syslog Priorities**

| Code | Priority | Priority description              |
| ---- | -------- | --------------------------------- |
| 0    | emerg    | System is unusable                |
| 1    | alert    | Action must be taken immediately  |
| 2    | crit     | Critical condition                |
| 3    | err      | Noncritical error condition       |
| 4    | warning  | Warning condition                 |
| 5    | notice   | Normal but significant event      |
| 6    | info     | Informational event               |
| 7    | debug    | Debugging-level message           |

## The Rsyslog Service

The `rsyslog` service implements the syslog logging. The `rsyslog` service uses the facility and priority of log messages to determine how to handle them.

Rules specify the facility and priority in the `/etc/rsyslog.conf` file and in any file in the `/etc/rsyslog.d` directory with the `.conf` extension. Software packages can add rules by installing an appropriate file in the `/etc/rsyslog.d` directory.

Each `rsyslog` rule consists of a filter, followed by an action.

Filters select a subset of the `syslog` messages by using various methods. For example, the facility/priority-based filter method indicates the facility and priority of the syslog messages that the rule matches. An asterisk (*) can act as a wildcard to match all possible values of a facility or a priority.

Actions indicate how to handle messages that match the specified filter. Many possible actions are available, and a rule can have more than one action. For example, an action can indicate which file to save the log message in.

The following rule in the `/etc/rsyslog.conf` file saves messages that are sent to the `authpriv` facility of any priority to the `/var/log/secure` file:

```bash
authpriv.* /var/log/secure
```

If you specify a priority for the selector of a rule, then all messages to that facility at the specified priority or higher are logged to the action that is associated with the rule.

The following rule saves messages that are sent to the `authpriv` facility at the warning, notice, info, or debug priorities to the `/var/log/secure` file:

```bash
authpriv.warning /var/log/secure
```

Sometimes, log messages match more than one rule in the `rsyslog.conf` file. In such cases, the message is stored in more than one log file. The none keyword in the priority field indicates that no messages for the indicated facility are stored in the given file, to limit stored messages.

Instead of being logged to a file, the `syslog` messages can also be printed to the terminals of all logged-in users. The `rsyslog.conf` file has a setting to print all the syslog messages with the `emerg` priority to the terminals of all logged-in users.

**Sample Rules of the Rsyslog Service**

```bash
#### RULES ####

# Log all kernel messages to the console.
# Logging much else clutters up the screen.
#kern.*                                                 /dev/console

# Log anything (except mail) of level info or higher.
# Don't log private authentication messages!
*.info;mail.none;authpriv.none;cron.none                /var/log/messages

# The authpriv file has restricted access.
authpriv.*                                              /var/log/secure

# Log all the mail messages in one place.
mail.*                                                  -/var/log/maillog


# Log cron stuff
cron.*                                                  /var/log/cron

# Everybody gets emergency messages
*.emerg                                                 :omusrmsg:*

# Save news errors of level crit and higher in a special file.
uucp,news.crit                                          /var/log/spooler

# Save boot messages also to boot.log
local7.*                                                /var/log/boot.log
```

Note

    The `syslog` subsystem has many more features beyond the scope of this course. To explore further, refer to the rsyslog.conf(5) man page and the extensive HTML documentation at `/usr/share/doc/rsyslog/html/index.html` that the rsyslog-doc package provides.

## Log File Rotation

The `logrotate` command is triggered by a systemd timer unit and rotates log files to prevent them from taking up too much space in the `/var/log` directory. When a log file is rotated, it is renamed with an extension that indicates the rotation date.

For example, the `/var/log/messages` file was be renamed to the `/var/log/messages-20250620` file when it was rotated on 2025-06-20. After the previous log file is rotated, a new log file is created and the log file's associated service is notified.

After approximately four weeks of log file rotations, the earliest log file is discarded to reclaim disk space.

A scheduled job runs the `logrotate` command daily to check the rotation requirements of various log files. Most log files are rotated weekly.

The `logrotate` command can rotate log files more quickly, or more slowly, or when the log files reach a specific size.


## Analyze a Log Entry

Log messages start with the earliest message at the start of the log file, and the latest message at the end of the log file. The rsyslog service uses a standard format for recording entries in log files.

The following example illustrates the anatomy of a log message in the `/var/log/secure` log file.

```bash
Mar 20 20:11:48 localhost sshd[1433]: Failed password for student from 172.25.0.10 port 59344 ssh2
```

- `Mar 20 20:11:48` : The time stamp of the log entry
- `localhost` : The host that sent the log message
- `sshd[1433]` : The program or process name and PID number that sent the log message
- `Failed password for` : The message that was sent.

## Monitor Log Events

Monitoring log files for events is helpful to reproduce issues. The `tail -f /path/to/file` command outputs the last ten lines of the specified file and continues to output newly written lines in the file.

For example, you can monitor login attempts by using a terminal session on two servers.

One terminal is for the `hostA` machine and the other terminal is for the `hostB` machine.

From the `hostA` machine in the first terminal, run the `tail -f` command and watch the `/var/log/secure` log file:

```bash
tail -f /var/log/secure
```

## Send Log Messages Manually

The `logger` command sends messages to the `rsyslog` service. By default, the logger command sends the message of the user type with the notice priority (user.notice) unless otherwise specified with the `-p` option. The logger command is helpful for testing changes to the rsyslog service configuration.

For example, log messages that match the `local7.*` facility or priority filter are saved in the `/var/log/boot.log` file, based on a rule set in the default `/etc/rsyslog.conf` file. Therefore, to send a message to the rsyslog service and to record the message in the `/var/log/boot.log` log file, execute the following logger command

```bash
logger -p local7.notice "Log entry created on host"
```

note 

    The `logger` command can also send structured journal entries to the system journal. For more information, see the documentation for the `--journald` option in the logger(1) man page.

---
# Finding and Interpreting System Journal Log Entries
---

## Find Events on the System Journal

The `systemd-journald` service stores logging data in a structured, indexed binary file that is known as a journal. This data includes extra information about the log event.

For example, for the `syslog` events, this information includes the priority of the original message, and the facility, which is a value that the `syslog` service assigns to track the process that originated a message.

Important

    In Red Hat Enterprise Linux, the memory-based `/run/log` directory holds the system journal by default. The contents of the `/run/log` directory are lost when the system is shut down. You can change the journald directory to a persistent location, which is discussed later in this lesson.

To retrieve log messages from the journal, use the `journalctl` command. You can use the journalctl command to view all messages in the journal, or to search for specific events based on options and criteria. If you run the command as the root user, then you have full access to the journal. Although regular users can also use the `journalctl` command, the system restricts them from seeing certain messages.

```bash
journalctl
```

The `journalctl` command highlights important log messages; messages with the notice or warning priority are in bold text, whereas messages with the error priority or higher are in red text.

The key to successful use of the journal for troubleshooting and auditing is to limit journal searches to show only relevant output.

By default, the `journalctl` command `-n` option shows the last 10 log entries. You can adjust the number of log entries with an optional argument that specifies how many log entries to display.

For example, to review the last five log entries, you can run the following journalctl command:

```bash
journalctl -n 5
```

Similar to the tail command, the `journalctl` command `-f` option outputs the last ten lines of the system journal and continues to output new journal entries when the journal appends them. To exit the `journalctl` command `-f` option, use the Ctrl+C key combination.

```bash
journalctl -f
```

To help troubleshoot problems, you can filter the output of the journal by the priority of the journal entries. The `journalctl` command `-p` option shows the journal entries with a specified priority level (by name or by number) or higher. The journalctl command processes the debug, info, notice, warning, err, crit, alert, and emerg priority levels, in ascending priority order.

As an example, run the following journalctl command to list journal entries with the err priority or higher:

```bash
journalctl -p err
```

You can show messages for a specified systemd unit by using the `journalctl` command `-u` option and the unit name.

```bash
journalctl -u sshd.service
```

When using the `journalctl` command to find specific events, you can limit the output to a specific time range by using the `--since` option or the `--until` option. Both options take a time argument in the `"YYYY-MM-DD hh:mm:ss"` format. The double quotation marks are required to preserve the space within each option's value.

The `journalctl` command uses the 00:00:00 format when the time argument is omitted, and uses the current day when the day argument is omitted. Both `journalctl` options support yesterday, today, and tomorrow as valid arguments in addition to the date and time.

As an example, run the following `journalctl` command to list all journal entries from today's records:

```bash
journalctl --since today
```

Run the following `journalctl` command to list all journals since 2025-06-01 20:30 and until 2025-06-04 10:00:

```bash
journalctl --since "2025-06-01 20:30" --until "2025-06-04 10:00"
```
You can also specify all entries since a relative time until the present.

For example, to specify all entries since the last hour, you can use the following command:

```bash
journalctl --since "-1 hour"
```

Note

    You can use other, more sophisticated time specifications with the --since and --until options. For some examples, see the systemd.time(7) man page

In addition to the default journal output, you can view all the fields for each journal record by specifying the verbose option. Verbose output is useful to help find more specific information about journal events. You can also specify any field name and value to filter the journal output.


```bash
journalctl -o verbose
```

```bash
Mon 2025-06-09 12:56:12.962826 UTC [s=ef6b97242c5140218987a8b063034712...
    _SOURCE_BOOTTIME_TIMESTAMP=0
    _SOURCE_MONOTONIC_TIMESTAMP=0
    _TRANSPORT=kernel
    PRIORITY=5
    SYSLOG_FACILITY=0
    SYSLOG_IDENTIFIER=kernel
    MESSAGE=Linux version 6.12.0-55.12.1.el10_0.x86_64 (mockbuild@...
    _BOOT_ID=d7f2dbc620504aa08585be2d04c4c596
    _MACHINE_ID=d676b38fd6a747d989b1e2dd98c0ffe8
    _HOSTNAME=localhost
    _RUNTIME_SCOPE=initrd
...output omitted...
lines 1-44 q
```

You can combine multiple system journal fields to form a granular search query with the journalctl command.

The following list shows some fields of the system journal to search for relevant lines to a particular process or event:

**_COMM:**
The command name

**_EXE:**
The path to the executable file for the process

**_PID:**
The PID of the process

**_UID:**
The UID of the user that runs the process

_SYSTEMD_UNIT
The systemd unit that started the process

For example, the following `journalctl` command shows all related journal entries to the sshd.service service with the 2188 PID:

```bash
journalctl _SYSTEMD_UNIT=sshd.service _PID=2188
```


Note

    For a list of journal fields, refer to the systemd.journal-fields(7) man page.

---
# Configuring a Persistent System Journal
---

## System Journal Storage

By default, Red Hat Enterprise Linux stores the system journal files in the `/run/log/journal` directory, and the system clears the system journal after a reboot. You can configure `systemd-journald` service to keep the journal files persistently, so that you can review journal events across reboots of the system.

## Configure a Persistent System Journal

Configure the `systemd-journald` service as follows to preserve system journals persistently across a reboot:

1. Create the /var/log/journal directory.

```bash
mkdir /var/log/journal
```

2. Run the `journalctl --flush` command to flush the current journal to storage. If the `systemd-journald` service successfully flushes the current journal, then the service creates subdirectories in the `/var/log/journal` directory.

```bash
journalctl --flush
```

3. The subdirectory in the `/var/log/journal` directory has hexadecimal characters in its long name and contains files with the `.journal` extension

```bash
ls /var/log/journal
```

4. The `.journal` binary files store structured and indexed journal entries.

```bash
ls /var/log/journal/4ec03abd2f7b40118b1b357f479b3112
```

Important

    This service works because the default setting of the Storage parameter in the journal configuration is set to `Storage=auto.` This parameter means that if the `/var/log/journal` directory exists, then persistent storage is automatically enabled, but if the storage does not get enabled, then volatile storage in the `/run/log/journal` directory is used instead.

    The journal configuration files are discussed in more detail later in this section.

## Review Journal Entries Relative to Boot Time

Although the system journals persist after a reboot, the `journalctl` command output includes entries from the current system boot as well as from the previous system boots. To limit the output to a specific system boot, use the `journalctl` command `-b` option.

The following journalctl command retrieves the entries from the first system boot only:

```bash
journalctl -b 1
```

The following `journalctl` command retrieves the entries from the second system boot only. The argument is meaningful only if the system was rebooted at least twice:

```bash
journalctl -b 2
```

You can list the system boot events that the `journalctl` command recognizes, by using the `--list-boots` option.

```bash
journalctl --list-boots
```

The following `journalctl` command retrieves the entries from the current system boot only:

```bash
journalctl -b
```

Note

    When debugging a system crash with a persistent journal, you must limit the journal query to the reboot before the crash happened. You can use the `journalctl` command `-b` option with a negative number to indicate how many earlier system boots to include in the output.

    For example, the `journalctl` command `-b -1` option limits the output to only the previous boot.

## System Journal Rotation

The advantage of persistent system journals is that the historical data is available immediately at boot. However, even with a persistent journal, the system does not keep all data forever.

The journal has a built-in log rotation mechanism that triggers monthly. In addition, the system does not allow the journals to get larger than 10% of the file system that they are on, or to leave less than 15% of the file system free. You can modify these values for both the runtime and persistent journals in the `/etc/systemd/journald.conf` configuration file. The systemd-journald process logs the current limits on the size of the journal when it starts.

The following command output shows the journal entries that reflect the current size limits:


```bash
journalctl | grep -E 'Runtime Journal|System Journal'
```

```bash
Jun 10 22:22:57 localhost systemd-journald[263]: Runtime Journal (/run/log/journal/93c43a50cada46e39819e0da68f790a2) is 4.2M, max 34.1M, 29.8M free.
Jun 10 22:23:01 host systemd-journald[740]: Runtime Journal (/run/log/journal/da54d37671ac4429bcdfacfe7bebb5a1) is 4.2M, max 34.1M, 29.8M free.
Jun 10 22:30:50 host systemd-journald[740]: System Journal (/var/log/journal/da54d37671ac4429bcdfacfe7bebb5a1) is 8M, max 997.3M, 989.3M free.
```

Note

    In the previous grep command, the vertical bar (|) symbol in the expression acts as an or operator. That is, the grep command matches any line with either the Runtime Journal string or the System Journal string from the `journalctl` command output. This command fetches the current size limits on the volatile (Runtime) journal store and on the persistent (System) journal store.

## Locating Journal Configuration Files

System administrators normally configure journal settings by editing the `/etc/systemd/journald.conf` configuration file, or by adding configuration files with a `.conf` suffix to the `/etc/systemd/journald.conf.d` directory.

However, a RHEL system might not have those files or that directory. In that case, lower-priority locations that are documented in the journal.conf(5) man page are checked for settings, and if none of those files or directories exist, then compiled-in default settings are used.

Important

    Starting from RHEL 10, the /etc/systemd/journald.conf file is not present at installation time. The systemd-journald service reads its default settings from the /usr/lib/systemd/journald.conf configuration file.

    To change the journal's behavior, do not edit the `/usr/lib/systemd/journald.conf` configuration file directly. Instead, copy the `/usr/lib/systemd/journald.conf` file to the `/etc/systemd` directory, and then uncomment and change the appropriate settings in the resulting `/etc/systemd/journald.conf` file. Configuration settings in the `/etc/systemd/journald.conf` file take precedence over the default settings in the `/usr/lib/systemd/journald.conf` file.

## Configure Automatic Journal Rotation

To configure automatic journal rotation for persistent or runtime-only journals, set the following parameters in the `/etc/systemd/journald.conf` file.

Prefix the settings with System for persistent journals in the `/var/log/journal` directory.

Prefix the settings with Runtime for volatile journals in the `/run/log/journal` directory.

**SystemMaxUse and RuntimeMaxUse:** 
The maximum amount of file system space that the journal can use. This value is 10% of the total file system space by default, and is capped at 4 GB.

**SystemMaxFileSize and RuntimeMaxFileSize:**
The maximum file size of a journal before it rotates. This value is one eighth of the SystemMaxUse/RuntimeMaxUse value by default, and is capped at 128 M, and usually supports keeping seven rotated journal files as history. If journal compact mode is enabled (the default), this value is capped at 4 GB.

**SystemKeepFree and RuntimeKeepFree:**
The minimum free file system space that must remain before archived journals are dropped. At least 15% of the total file system space is always kept free by default. This value is capped at 4 GB.

Important

    Only files with the .journal or .journal~ suffixes are considered journal files.

After editing the `/etc/systemd/journald.conf` configuration file, restart the `systemd-journald` service to apply the configuration changes.

```bash
systemctl restart systemd-journald
```
