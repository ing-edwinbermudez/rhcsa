# The System Log Architecture
---

## System Logging

The operating system kernel and other processes record a log of events that happen when the system is running. These logs are used to audit the system and to troubleshoot problems. You can use text utilities such as the `less` and `tail` commands to inspect these logs.

Red Hat Enterprise Linux uses a standard logging system that is based on the `syslog` protocol to log the system messages. Many programs use the logging system to record events and to organize them into log files. The `systemd-journald` and `rsyslog` services handle the `syslog` messages in Red Hat Enterprise Linux.

The `systemd-journald` service is at the heart of the operating system event logging architecture.

The `systemd-journald` service collects event messages from many sources:

- System Kernel
- Output from the early stages of the boot process.
- Standard output and standard error from daemons
- The `syslog` events.

The `systemd-journald` service restructures the logs into a standard format and writes them into a structured, indexed system journal. By default, this journal is stored on a file system that does not persist across reboots.

The `rsyslog` service reads the syslog messages that the `systemd-journald` service receives from the journal when they arrive. The `rsyslog` service then processes the `syslog` events, and records them to its log files or forwards them to other services according to its own configuration.

Note

    In RHEL 10, the operating system sends the local syslog messages to the `/dev/log` file, which is a symbolic link to a special socket file read by the `systemd-journald` service. Those messages are recorded to the system journal by the `systemd-journald` service.

    Meanwhile, the `rsyslog` service does not read the `/dev/log` file directly. Instead, the `rsyslog` service uses its `imjournal` module to read the syslog messages from the system journal as they arrive, and then saves those log messages into files based on the configuration files.

The `rsyslog` service sorts and writes the syslog messages to the log files that do persist across reboots in the `/var/log` directory. The `rsyslog` service also sorts the syslog messages to specific log files according to the type of program that sent each message and the priority of each message.

In addition to the syslog message files, the `/var/log` directory contains log files from other services on the system.

The following table lists some useful files in the `/var/log` directory:

**Selected System Log Files**

| Log file          | Type of stored messages                                                                                                                                              |
| ----------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| /var/log/messages | Most syslog messages are logged here. Exceptions include messages about authentication and email processing, scheduled job execution, and purely debugging-related messages. |
| /var/log/secure   | Messages about security and authentication events                                                                                                                   |
| /var/log/maillog  | Messages about the mail server                                                                                                                                       |
| /var/log/cron     | Messages about scheduled job execution                                                                                                                              |
| /var/log/boot.log | Console messages about system startup that are hidden by the graphical startup screen, and the syslog messages that are sent to the local7 facility.                 |


The boot log stored in the `/var/log/boot.log` file can be populated from two sources.

The splash screen, which the Plymouth application provides and that is displayed when the system starts, and hides many diagnostic messages by default. Plymouth dumps these diagnostic messages to the `/var/log/boot.log` file.

The `rsyslog` service also saves any log messages that is sent to its local7 facility (typically messages about the boot process) as a line in the same `/var/log/boot.log` file.

Some applications do not use the syslog service to manage their log messages. For example, the Apache HTTP Server saves log messages to files in a subdirectory of the `/var/log` directory.

---
# Interpreting and Managing Syslog Events
---

## Log Events to the System

Many programs use the `syslog` protocol to log events to the system. Each log message is categorized by facility (the subsystem that produces the message) and priority (the message's severity).

The following table lists the standard `syslog` facilities:

**Overview of Syslog Facilities**

| Code   | Facility       | Facility description                    |
| ------ | -------------- | --------------------------------------- |
| 0      | kern           | Kernel messages                         |
| 1      | user           | User-level messages                     |
| 2      | mail           | Mail system messages                    |
| 3      | daemon         | System daemon messages                  |
| 4      | auth           | Authentication and security messages    |
| 5      | syslog         | Internal syslog messages                |
| 6      | lpr            | Printer messages                        |
| 7      | news           | Network news messages                   |
| 8      | uucp           | UUCP protocol messages                  |
| 9      | cron           | Clock daemon messages                   |
| 10     | authpriv       | Nonsystem authorization messages        |
| 11     | ftp            | FTP protocol messages                   |
| 16-23 | local0 to local7 | Custom local messages                   |


The following table lists the standard syslog priorities in descending order:

**Overview of Syslog Priorities**

| Code | Priority | Priority description              |
| ---- | -------- | --------------------------------- |
| 0    | emerg    | System is unusable                |
| 1    | alert    | Action must be taken immediately  |
| 2    | crit     | Critical condition                |
| 3    | err      | Noncritical error condition       |
| 4    | warning  | Warning condition                 |
| 5    | notice   | Normal but significant event      |
| 6    | info     | Informational event               |
| 7    | debug    | Debugging-level message           |

## The Rsyslog Service

The `rsyslog` service implements the syslog logging. The `rsyslog` service uses the facility and priority of log messages to determine how to handle them.

Rules specify the facility and priority in the `/etc/rsyslog.conf` file and in any file in the `/etc/rsyslog.d` directory with the `.conf` extension. Software packages can add rules by installing an appropriate file in the `/etc/rsyslog.d` directory.

Each `rsyslog` rule consists of a filter, followed by an action.

Filters select a subset of the `syslog` messages by using various methods. For example, the facility/priority-based filter method indicates the facility and priority of the syslog messages that the rule matches. An asterisk (*) can act as a wildcard to match all possible values of a facility or a priority.

Actions indicate how to handle messages that match the specified filter. Many possible actions are available, and a rule can have more than one action. For example, an action can indicate which file to save the log message in.

The following rule in the `/etc/rsyslog.conf` file saves messages that are sent to the `authpriv` facility of any priority to the `/var/log/secure` file:

```bash
authpriv.* /var/log/secure
```

If you specify a priority for the selector of a rule, then all messages to that facility at the specified priority or higher are logged to the action that is associated with the rule.

The following rule saves messages that are sent to the `authpriv` facility at the warning, notice, info, or debug priorities to the `/var/log/secure` file:

```bash
authpriv.warning /var/log/secure
```

Sometimes, log messages match more than one rule in the `rsyslog.conf` file. In such cases, the message is stored in more than one log file. The none keyword in the priority field indicates that no messages for the indicated facility are stored in the given file, to limit stored messages.

Instead of being logged to a file, the `syslog` messages can also be printed to the terminals of all logged-in users. The `rsyslog.conf` file has a setting to print all the syslog messages with the `emerg` priority to the terminals of all logged-in users.

**Sample Rules of the Rsyslog Service**

```bash
#### RULES ####

# Log all kernel messages to the console.
# Logging much else clutters up the screen.
#kern.*                                                 /dev/console

# Log anything (except mail) of level info or higher.
# Don't log private authentication messages!
*.info;mail.none;authpriv.none;cron.none                /var/log/messages

# The authpriv file has restricted access.
authpriv.*                                              /var/log/secure

# Log all the mail messages in one place.
mail.*                                                  -/var/log/maillog


# Log cron stuff
cron.*                                                  /var/log/cron

# Everybody gets emergency messages
*.emerg                                                 :omusrmsg:*

# Save news errors of level crit and higher in a special file.
uucp,news.crit                                          /var/log/spooler

# Save boot messages also to boot.log
local7.*                                                /var/log/boot.log
```

Note

    The `syslog` subsystem has many more features beyond the scope of this course. To explore further, refer to the rsyslog.conf(5) man page and the extensive HTML documentation at `/usr/share/doc/rsyslog/html/index.html` that the rsyslog-doc package provides.

## Log File Rotation

The `logrotate` command is triggered by a systemd timer unit and rotates log files to prevent them from taking up too much space in the `/var/log` directory. When a log file is rotated, it is renamed with an extension that indicates the rotation date.

For example, the `/var/log/messages` file was be renamed to the `/var/log/messages-20250620` file when it was rotated on 2025-06-20. After the previous log file is rotated, a new log file is created and the log file's associated service is notified.

After approximately four weeks of log file rotations, the earliest log file is discarded to reclaim disk space.

A scheduled job runs the `logrotate` command daily to check the rotation requirements of various log files. Most log files are rotated weekly.

The `logrotate` command can rotate log files more quickly, or more slowly, or when the log files reach a specific size.


## Analyze a Log Entry

Log messages start with the earliest message at the start of the log file, and the latest message at the end of the log file. The rsyslog service uses a standard format for recording entries in log files.

The following example illustrates the anatomy of a log message in the `/var/log/secure` log file.

```bash
Mar 20 20:11:48 localhost sshd[1433]: Failed password for student from 172.25.0.10 port 59344 ssh2
```

- `Mar 20 20:11:48` : The time stamp of the log entry
- `localhost` : The host that sent the log message
- `sshd[1433]` : The program or process name and PID number that sent the log message
- `Failed password for` : The message that was sent.

## Monitor Log Events

Monitoring log files for events is helpful to reproduce issues. The `tail -f /path/to/file` command outputs the last ten lines of the specified file and continues to output newly written lines in the file.

For example, you can monitor login attempts by using a terminal session on two servers.

One terminal is for the `hostA` machine and the other terminal is for the `hostB` machine.

From the `hostA` machine in the first terminal, run the `tail -f` command and watch the `/var/log/secure` log file:

```bash
tail -f /var/log/secure
```

## Send Log Messages Manually

The `logger` command sends messages to the `rsyslog` service. By default, the logger command sends the message of the user type with the notice priority (user.notice) unless otherwise specified with the `-p` option. The logger command is helpful for testing changes to the rsyslog service configuration.

For example, log messages that match the `local7.*` facility or priority filter are saved in the `/var/log/boot.log` file, based on a rule set in the default `/etc/rsyslog.conf` file. Therefore, to send a message to the rsyslog service and to record the message in the `/var/log/boot.log` log file, execute the following logger command

```bash
logger -p local7.notice "Log entry created on host"
```

note 

    The `logger` command can also send structured journal entries to the system journal. For more information, see the documentation for the `--journald` option in the logger(1) man page.

