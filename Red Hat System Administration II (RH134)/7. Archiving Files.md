# Managing Compressed Tar Archives
---

## Create Archives from the Command Line

An archive is a single regular file or device file that contains multiple files. The device file could be a tape drive, flash drive, or other removable media. When using a regular file, archiving is analogous to the zip utility and similar variations that are popular on most operating systems.

Archive files are used to create manageable personal backups, or to simplify transferring a set of files across a network when other methods, such as the `rsync` utility, are unavailable or might be more complex. Archive files can be created with or without using compression to reduce the archive file size.

<div style="border: 1px solid #aaa; border-radius: 6px; padding: 12px; background: #020202ff;">
<b>Note:</b><br><br>
The original, ubiquitous zip compression and file packaging utility uses the PKZIP (Phil Katz's ZIP for MS-DOS systems) algorithm, and is supported on RHEL with the zip and unzip commands. Many other compression algorithms have been developed since zip was introduced, and each one has its advantages in speed or compression ratio. For creating compressed archives for general use, any tar-supported compression algorithm is acceptable.<br><br>
</div>

On Linux, the `tar` utility is the common command to create, manage, and extract archives. Use the `tar` command to gather multiple files into a single archive file. A tar archive is a structured sequence of file metadata and data with an index so you can extract individual files.

Files can be compressed during creation by using one of the supported compression algorithms. The `tar` command can list the contents of an archive without extracting, and can extract original files directly from both compressed and uncompressed archives.

### Options of the Tar Utility

One of the following tar command actions is required to perform a tar operation

- `-c` or --create : Create an archive file.
- `-t` or --list : List the contents of an archive.
- `-x` or --extract : Extract an archive.

The following `tar` command general options are often included:

- `-v` or --verbose : Show the files that are being archived or extracted during the tar operation.
- `-f` or --file : Follow this option with the archive file name to create or open.
- `-p` or --preserve-permissions : Preserve the original file permissions when extracting.
- `--xattrs` : Enable extended attribute support, and store extended file attributes.
- `--selinux` : Enable SELinux context support, and store SELinux file contexts.

The following tar command compression options are used to select an algorithm:

- `-a` or --auto-compress : Use the archive's suffix to determine the algorithm to use.
- `-z` or --gzip : Use the gzip compression algorithm, which results in a .tar.gz suffix.
- `-j` or --bzip2 : Use the bzip2 compression algorithm, which results in a .tar.bz2 suffix.
- `-J` or --xz : Use the xz compression algorithm, which results in a .tar.xz suffix.

<div style="border: 1px solid #aaa; border-radius: 6px; padding: 12px; background: #020202ff;">
<b>Note:</b><br><br>
The tar command still supports the legacy option style that does not use a dash (-) character. You might find this syntax in legacy scripts or documentation, and the behavior is essentially the same. For command consistency, Red Hat recommends using the short- or long-option styles instead..<br><br>
</div>

# Create an Archive

To create an archive with the `tar` command, use the `-c` and `-f` options with the archive file name as the first argument, followed by a list of files and directories to include in the archive.

The `tar` command recognizes absolute and relative file name syntax. By default, `tar` removes the leading forward slash (/) character from absolute file names, so that files are stored internally with relative path names. This technique is safer, because extracting absolute path names always overwrites existing files. With files that are archived with relative path names, files can be extracted to a new directory without overwriting existing files.

The following command creates the mybackup.tar archive to contain the myapp1.log, myapp2.log, and myapp3.log files from the user's home directory. If a file with the same name as the requested archive exists in the target directory, then the tar command overwrites the file.

```bash
tar -cf mybackup.tar myapp1.log myapp2.log myapp3.log
```

A user must have read permission on the target files that are being archived. For example, creating an archive in the `/etc` directory requires root privileges, because only privileged users can read all `/etc` files. An unprivileged user can create an archive of the `/etc` directory, but the archive excludes files that the user cannot read, and excludes directories for which the user lacks the read and execute permissions.

In this example, the root user creates the `/root/etc-backup.tar` archive of the `/etc` directory.

```bash
tar -cf /root/etc-backup.tar /etc
```

<div style="border: 1px solid #aaa; border-radius: 6px; padding: 12px; background: #020202ff;">
<b>Important:</b><br><br>
Extended file attributes, such as access control lists (ACL) and SELinux file contexts, are not preserved by default in an archive. Use the --acls option to include POSIX ACLs; use the --selinux option to include SELinux file contexts; or use the --xattrs option to include other extended attributes..<br><br>
Although extended attributes are outside the scope of this lesson, you can find more information in the references section.<br><br>
</div>

## List Archive Contents

Use the `tar` command `-t` option to list the file names from within the archive that is specified with the `-f` option. The files are listed with relative name syntax, because the leading forward slash was removed during archive creation

```bash
tar -tf /root/etc.tar
```

## Extract Archive Contents

Extract a tar archive to an empty directory to avoid overwriting existing files. When the root user extracts an archive, the extracted files preserve the original user and group ownership. If a regular user extracts files, then the user becomes the owner of the extracted files.

Create the `/root/etcbackup` directory to extract the tar archive

```bash
mkdir /root/etcbackup
```

List the file names in the `/root/etc.tar` archive.

```bash
tar -tf /root/etc.tar
```

Extract the archive to the `/root/etcbackup` directory:

```bash
cd ~/etcbackup
tar -xf /root/etc.tar
```

When you extract files from an archive, the current `umask` is used to modify each extracted file's permissions. Instead, use the `tar` command `-p` option to preserve the original archived permissions for extracted files. The `-p` option is enabled by default for a superuser.

```bash
tar -xpf /home/user/myscripts.tar
```

## Create a Compressed Archive

The `tar` command supports these compression methods, and others:

- The `gzip` compression is the earlier, fastest method, and is widely available across platforms.
- The `bzip2` compression creates smaller archives but is less widely available than `gzip`.
- The `xz` compression is later, and offers the best compression ratio of the available methods.

The effectiveness of any compression algorithm depends on the type of data that is compressed. Previously compressed data files, such as picture formats or RPM files, typically do not significantly compress further, regardless of the compression algorithm that is used.

Create the `/root/etcbackup.tar.gz` archive with gzip compression from the contents of the `/etc` directory:

```bash
tar -czf /root/etcbackup.tar.gz /etc
```

Create the `/root/logbackup.tar.bz2` archive with `bzip2` compression from the contents of the `/var/log` directory:

```bash
tar -cjf /root/logbackup.tar.bz2 /var/log
```

Create the `/root/sshconfig.tar.xz` archive with `xz` compression from the contents of the `/etc/ssh` directory:

```bash
tar -cJf /root/sshconfig.tar.xz /etc/ssh
```


After creating a compressed archive, you can still verify its table of contents with the `tar` command `-tf` options. It is not necessary to specify the compression option when listing a compressed archive file, because the compression type is read from the archive's header.

List the archived content in the `/root/etcbackup.tar.gz` file, which uses the `gzip` compression:

```bash
tar -tf /root/etcbackup.tar.gz
```

## Extract Compressed Archive Contents

The `tar` command can automatically determine which compression was used, so it is not necessary to specify the compression option. If you include an incorrect compression type, then the tar command reports that the specified compression type does not match the file's type. Listing a compressed tar archive works in the same way as listing an uncompressed tar archive.

In the following example, the tar command uses the `-z` option, which indicates `gzip` compression, but the file name extension is `.xz`, which indicates `xz` compression:

```bash
tar -xzf /root/etcbackup.tar.xz
```

The `gzip`, `bzip2`, and `xz` algorithms are also implemented as stand-alone commands for compressing individual files without creating an archive. With these commands, you cannot create a single compressed file of multiple files, such as a directory. As previously discussed, to create a compressed archive of multiple files, use the `tar` command with your preferred compression option. To uncompress a single compressed file or a compressed archive file without extracting its contents, use the `gunzip`, `bunzip2`, or `unxz` stand-alone commands.

The `gzip` and `xz` commands provide the `-l` option to view the uncompressed size of a compressed single or archive file. Use this option to verify that enough space is available before uncompressing or extracting a file.

```bash
gzip -l file.tar.gz
```

Use the `xz` command to view the uncompressed size of the `file.tar.gz` archive.

```bash
xz -l file.tar.xz
```

