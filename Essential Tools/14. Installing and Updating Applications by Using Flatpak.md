# Installing and Updating Applications by Using Flatpak

## Introduction to Flatpak

Although the model for packaging applications in Linux has evolved significantly over the years, it still presents challenges:

Developers must tailor their applications for a specific Linux operating system and version. As a result, developers spend more time and effort to package applications for each distribution.

Users might run into technical difficulties in deploying an application that is not packaged specifically for their preferred distribution.

Development and maintenance can be complex because dependencies for an application can differ between the production environment and the development platform.

Flatpak addresses these challenges by applying server-side container concepts and Linux kernel technology to the desktop environment. When a desktop application is packaged as a Flatpak image, the application can run reliably on most Linux distributions and versions. Applications do not behave incorrectly or crash due to discrepancies in dependencies.

With Flatpak, each application is built and run in an isolated environment that is called a sandbox. By default, the application can access only the contents of its sandbox. The application's access to files, the network, graphics sockets, the system bus, and devices must be explicitly granted. The application's access to other resources, such as other processes, is not possible by design.

## Flatpak Runtimes

In a Flatpak sandbox, the application uses its own libraries, not the operating system's libraries. However, maintaining a separate copy of all libraries for each desktop application consumes too much space, so many applications can share a Flatpak runtime. A runtime is a file-system image with system-level libraries and other files. A system can provide multiple runtimes that different applications can use.

Another significant benefit of runtime separation is with managing security updates. When a security vulnerability is discovered in a system library, developers must update only the runtime without having to rebuild each application.

A runtime might not provide every library that an application requires. Therefore, the application can also bundle its own libraries.

## Managing Flatpak Remote Repositories

Flatpak applications and runtimes are distributed in repositories that are named remotes. Red Hat packages several open source applications and distributes them in a remote repository. Although unsupported, third-party remote repositories are also available; they complement the Red Hat catalog and offer a broad selection of applications. The largest and best-known third-party repository is Flathub, which is available at https://flathub.org. The Fedora Project also has its own Flatpak remote repository.

**Important**
Red Hat does not support applications from third-party remote repositories.

You can use either the flatpak command or the GNOME Software graphical tool to manage packages. With either tool, you can configure multiple remote repositories, and simplify Flatpak management though unified interfaces.

## Initial Flatpak Setup

Flatpak is installed by default in Red Hat Enterprise Linux 10 along with the gnome-software RPM package.

If Flatpak is not installed, then you can install it by using the dnf command:

```bash
 dnf install flatpak
```

To display the version of Flatpak that is installed on your system, use the `flatpak --version` command:

```bash
flatpak --version
```

The default remote repository for RHEL 10 is the Flatpak object repository in the Red Hat Ecosystem Catalog. To access this repository, you must provide your Red Hat Customer Portal account credentials or your registry service account tokens.

```bash
podman login registry.redhat.io
```

By default, the login credentials expire after the current session. However, you can permanently save the credentials for the current user:

```bash
cp $XDG_RUNTIME_DIR/containers/auth.json \
$HOME/.config/flatpak/oci-auth.json
```

You can also save the credentials system-wide.

```bash
cp $XDG_RUNTIME_DIR/containers/auth.json \
/etc/flatpak/oci-auth.json
```

If you want regular users to access the remote repository with the same credentials, then you must change the file permissions on the authentication token:

```bash
chmod 644 /etc/flatpak/oci-auth.json
```

To list all the remote repositories that are configured on your system, use the `flatpak remotes` command:

```bash
flatpak remotes
```

To show the details for the remote repositories, add the `-d` parameter to the `flatpak remotes` command. Details include the repository name, its unique identifier, and other properties such as the repository URL and configured options.

```bash
flatpak remotes -d
```

To list the applications that are available in a remote repository, use the `flatpak remote-ls` command. To ignore runtimes and list only the applications, add the `--app` option:

```bash
flatpak remote-ls --app
```

## Adding a Flatpak Remote Repository

From the command line, you can configure additional remote repositories as installation sources and expand the catalog of Flatpak applications.

For example, the Fedora Project hosts a remote registry that other distributions can also use because of Flatpak's universal design. To add this remote repository, run the `flatpak remote-add` command. The first argument defines the name for the local copy of the remote repository. The second argument defines the remote repository's location, which can point either to the actual location or to the definition file with the `.flatpakrepo` extension. The `--if-not-exists` option avoids overwriting the remote repository if it exists in the system:

```bash
 flatpak remote-add --if-not-exists fedora \
oci+https://registry.fedoraproject.org
```
To confirm that the Fedora repository is added as an installation source, use the `flatpak remotes` command to list all the remote repositories that are configured on your system:

```bash
flatpak remotes
```

By default, the `flatpak` command applies operations to the whole system, as if the `--system` option was used explicitly. In the previous example, the newly added remote repository is available to all users on the system to search and install packages from.

However, you can also configure a repository in user installation mode by adding the `--user` option. In that mode, the Flatpak object is available only to the user that ran the command.

The following example shows configuring the Flathub repository in user mode:

```bash
flatpak remotes --system
```

List the remote repositories that are available to the current user:

```bash
flatpak remotes --user
```

After adding a remote repository, you can list the repository's contents by using the `flatpak remote-ls` command:

```bash
flatpak remote-ls fedora --app
```

## Removing a Flatpak Remote Repository

To remove a Flatpak remote repository, use the `flatpak remote-delete` command. Before a remote repository is deleted, all software that is installed from that repository must be uninstalled. The command prompts you to confirm the removal of all associated references (applications and runtimes) before continuing.

```bash
flatpak remote-delete fedora
```

Instead of permanently deleting a repository and uninstalling all software that was sourced from it, you can disable the repository. Disabling a repository does not require removing previously installed Flatpaks. To disable a repository, use the `flatpak remote-modify` command.

```bash
flatpak remote-modify --disable fedora
```

You can also re-enable the repository later if, for example, you must update one of the packages.

```bash
flatpak remote-modify --enable fedora
```

## Managing Flatpak with the GNOME Software Graphical Tool

In the Software Repositories pop-up window, Flatpak applications are listed in the Apps (Flatpak) section. From this window, you can enable or disable the configured remote repositories.
