# Installing and Updating Applications by Using Flatpak

## Introduction to Flatpak

Although the model for packaging applications in Linux has evolved significantly over the years, it still presents challenges:

Developers must tailor their applications for a specific Linux operating system and version. As a result, developers spend more time and effort to package applications for each distribution.

Users might run into technical difficulties in deploying an application that is not packaged specifically for their preferred distribution.

Development and maintenance can be complex because dependencies for an application can differ between the production environment and the development platform.

Flatpak addresses these challenges by applying server-side container concepts and Linux kernel technology to the desktop environment. When a desktop application is packaged as a Flatpak image, the application can run reliably on most Linux distributions and versions. Applications do not behave incorrectly or crash due to discrepancies in dependencies.

With Flatpak, each application is built and run in an isolated environment that is called a sandbox. By default, the application can access only the contents of its sandbox. The application's access to files, the network, graphics sockets, the system bus, and devices must be explicitly granted. The application's access to other resources, such as other processes, is not possible by design.

## Flatpak Runtimes

In a Flatpak sandbox, the application uses its own libraries, not the operating system's libraries. However, maintaining a separate copy of all libraries for each desktop application consumes too much space, so many applications can share a Flatpak runtime. A runtime is a file-system image with system-level libraries and other files. A system can provide multiple runtimes that different applications can use.

Another significant benefit of runtime separation is with managing security updates. When a security vulnerability is discovered in a system library, developers must update only the runtime without having to rebuild each application.

A runtime might not provide every library that an application requires. Therefore, the application can also bundle its own libraries.

## Managing Flatpak Remote Repositories

Flatpak applications and runtimes are distributed in repositories that are named remotes. Red Hat packages several open source applications and distributes them in a remote repository. Although unsupported, third-party remote repositories are also available; they complement the Red Hat catalog and offer a broad selection of applications. The largest and best-known third-party repository is Flathub, which is available at https://flathub.org. The Fedora Project also has its own Flatpak remote repository.

**Important**
Red Hat does not support applications from third-party remote repositories.

You can use either the flatpak command or the GNOME Software graphical tool to manage packages. With either tool, you can configure multiple remote repositories, and simplify Flatpak management though unified interfaces.

## Initial Flatpak Setup

Flatpak is installed by default in Red Hat Enterprise Linux 10 along with the gnome-software RPM package.

If Flatpak is not installed, then you can install it by using the dnf command:

```bash
 dnf install flatpak
```

To display the version of Flatpak that is installed on your system, use the `flatpak --version` command:

```bash
flatpak --version
```

The default remote repository for RHEL 10 is the Flatpak object repository in the Red Hat Ecosystem Catalog. To access this repository, you must provide your Red Hat Customer Portal account credentials or your registry service account tokens.

```bash
podman login registry.redhat.io
```

By default, the login credentials expire after the current session. However, you can permanently save the credentials for the current user:

```bash
cp $XDG_RUNTIME_DIR/containers/auth.json \
$HOME/.config/flatpak/oci-auth.json
```

You can also save the credentials system-wide.

```bash
cp $XDG_RUNTIME_DIR/containers/auth.json \
/etc/flatpak/oci-auth.json
```

If you want regular users to access the remote repository with the same credentials, then you must change the file permissions on the authentication token:

```bash
chmod 644 /etc/flatpak/oci-auth.json
```

To list all the remote repositories that are configured on your system, use the `flatpak remotes` command:

```bash
flatpak remotes
```

To show the details for the remote repositories, add the `-d` parameter to the `flatpak remotes` command. Details include the repository name, its unique identifier, and other properties such as the repository URL and configured options.

```bash
flatpak remotes -d
```

To list the applications that are available in a remote repository, use the `flatpak remote-ls` command. To ignore runtimes and list only the applications, add the `--app` option:

```bash
flatpak remote-ls --app
```

## Adding a Flatpak Remote Repository

From the command line, you can configure additional remote repositories as installation sources and expand the catalog of Flatpak applications.

For example, the Fedora Project hosts a remote registry that other distributions can also use because of Flatpak's universal design. To add this remote repository, run the `flatpak remote-add` command. The first argument defines the name for the local copy of the remote repository. The second argument defines the remote repository's location, which can point either to the actual location or to the definition file with the `.flatpakrepo` extension. The `--if-not-exists` option avoids overwriting the remote repository if it exists in the system:

```bash
 flatpak remote-add --if-not-exists fedora \
oci+https://registry.fedoraproject.org
```
To confirm that the Fedora repository is added as an installation source, use the `flatpak remotes` command to list all the remote repositories that are configured on your system:

```bash
flatpak remotes
```

By default, the `flatpak` command applies operations to the whole system, as if the `--system` option was used explicitly. In the previous example, the newly added remote repository is available to all users on the system to search and install packages from.

However, you can also configure a repository in user installation mode by adding the `--user` option. In that mode, the Flatpak object is available only to the user that ran the command.

The following example shows configuring the Flathub repository in user mode:

```bash
flatpak remotes --system
```

List the remote repositories that are available to the current user:

```bash
flatpak remotes --user
```

After adding a remote repository, you can list the repository's contents by using the `flatpak remote-ls` command:

```bash
flatpak remote-ls fedora --app
```

## Removing a Flatpak Remote Repository

To remove a Flatpak remote repository, use the `flatpak remote-delete` command. Before a remote repository is deleted, all software that is installed from that repository must be uninstalled. The command prompts you to confirm the removal of all associated references (applications and runtimes) before continuing.

```bash
flatpak remote-delete fedora
```

Instead of permanently deleting a repository and uninstalling all software that was sourced from it, you can disable the repository. Disabling a repository does not require removing previously installed Flatpaks. To disable a repository, use the `flatpak remote-modify` command.

```bash
flatpak remote-modify --disable fedora
```

You can also re-enable the repository later if, for example, you must update one of the packages.

```bash
flatpak remote-modify --enable fedora
```

## Managing Flatpak with the GNOME Software Graphical Tool

In the Software Repositories pop-up window, Flatpak applications are listed in the Apps (Flatpak) section. From this window, you can enable or disable the configured remote repositories.

# Managing Applications from Flatpak

## Managing Applications with the Flatpak CLI

By using Flatpak CLI commands, you can list, search, install, update, remove, and get metadata information for Flatpak applications and their runtime dependencies. You can use content from the repository from Red Hat and from third-party remote repositories. Red Hat does not support applications or runtimes from third-party remote repositories.

### Flatpak Identifiers

Flatpak applications and runtimes use unique identifiers that follow the `domain.organization.App` format. This three-part identifier enables a company, developer, or organization to publish many applications with a shared prefix, such as `com.company`. The last segment (.App) identifies the application's name. You can use either the full or short object identifier for Flatpak operations: `com.company.App` or App.

In some scenarios, you must specify the CPU architecture or version, such as stable or beta. You can request these additional specifications by using an object's identifier triple. The format of an identifier triple is `ID/architecture/branch`, such as `org.organization.App/x86_64/stable`. In Flatpak, branch refers to different versions of the same object

You can leave blank some parts of the identifier triple to specify part of the object. For example, `org.organization.App/x86_64//` specifies only the architecture, and `org.organization.App//stable` specifies only the branch.

### Querying Remote Repositories for Available Objects

The `flatpak search` command lists matching applications and runtimes that are available in all the remote repositories that are enabled in the system. This command uses cached appstream metadata that is already downloaded from the remote repository. If the cached metadata is more than one day old, then the metadata is updated automatically when the command is executed.

The command uses a keyword to find a match in any of the metadata attributes that the application's XML file defines:

- Application or runtime name
- Description
- Application identifier
- Keyword that the developer defines

The keyword is case-insensitive, and returns information for applications and runtimes that match the query.

The following example shows a search that uses the `thunderbird` keyword to find applications in Flatpak remote repositories:

```bash
flatpak -v search thunderbird 
```

### Installing Flatpak Objects from Remote Repositories

The `flatpak install` command installs the requested objects, including all dependencies.

```bash
flatpak install thunderbird
```

The following table shows some useful options for the `flatpak install` command:

| Option            | Description                                                             |
|-------------------|-------------------------------------------------------------------------|
| `--runtime`       | Installs only runtimes                                                  |
| `--app`           | Installs only applications                                              |
| `--or-update`     | Performs an update if the application or runtime is already installed   |
| `--system`        | Installs the application or runtime in the default system-wide installation |
| `-u`, `--user`    | Installs the application or runtime for the current user only           |
| `-y`, `--assumeyes` | Automatically answers yes for all questions                           |
| `--no-deploy`     | Downloads to local cache without installing                             |
| `--no-pull`       | Installs from local cache only                                          |
| `--noninteractive`| Produces minimal output and assumes yes for all questions               |

### Querying Flatpak Objects Locally

You can list all the installed Flatpak objects by using the `flatpak list` command.
```bash
flatpak list
```

The `flatpak info` command shows information about the installed object based on the object identifier.

```bash
flatpak info org.mozilla.Thunderbird
```

### Installing Flatpak Objects from Specific Branches

Several versions of a Flatpak object might be available in a remote repository. Those versions are identified as branches. Branches can be designated by version numbers, such as `1.1` and `1.2`, or by terms that represent the application lifecycle, such as `stable`, `beta`, or `nightl`.

Use the `flatpak remote-info` command to verify which branches are available for a specific object. If only one branch is available for the requested identifier, then the command shows the output immediately. If more than one branch exists for the requested identifier, then the command returns an error and prompts for more information.

```bash
flatpak remote-info rhel com.redhat.Platform
```

If you know which branch to point, then you can specify the object version by using its identifier triple.

```bash
flatpak install com.redhat.Platform/x86_64/el8
```

### Updating Flatpak Objects

Use the `flatpak update` command to upgrade all your installed objects to the latest version in their respective branches. This command updates all objects. To update a single object, add the object identifier as an argument.

```bash
flatpak update com.redhat.Platform
```

**Note**
The flatpak update command checks for updates within the same branch from which the application was initially installed. If a later version exists in a different branch, then Flatpak does not recognize the update. This behavior is similar to branches in a Git repository: checking out a branch means that you work only on that branch.

To prevent the unwanted upgrade of certain objects, use the `flatpak mask` command. To mask a single object, add the object identifier as an argument.

```bash
flatpak mask com.redhat.Platform
```

To unmask an object, use the flatpak mask --remove command with the object identifier.

```bash
flatpak mask --remove com.redhat.Platform
```

### Uninstalling Flatpak Objects

The `flatpak uninstall` command removes Flatpak objects from the system.

If you intend to uninstall a runtime object, then you must ensure that no installed application uses the object as a dependency, or you must use the `--force-remove` option to ignore dependency resolution.

When you uninstall an application, the application's data directory remains in the system, in the `~/.var/app` directory. To avoid consuming storage space with stale data, you can use the `--delete-data` option.

```bash
flatpak uninstall --delete-data thunderbird
```

### Managing Flatpak Objects with the GNOME Software Graphical Tool

You can search for, install, uninstall, or update Flatpak applications by using the GNOME Software graphical tool.

From the GNOME graphical desktop environment, click Activities, and then select Software from the dashboard or use the Show Applications button to find the tool. You can also use the `gnome-software` command to open the GNOME Software tool.

GNOME Software integrates DNF and Flatpak packages seamlessly regardless of their different source repositories.

You can browse through the recommended applications by category, remove installed components, or check for updates. You can search for specific applications by using the search bar in the upper-left corner. In the search bar, type the keyword to search and the GNOME Software tool returns all the results that match, including both DNF packages and Flatpak objects.

After you select the intended object, the GNOME Software tool displays the details of the Flatpak component