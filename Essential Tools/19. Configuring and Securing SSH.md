# Configuring and Securing SSH

## Managing SSH Host Keys

### The Role of SSH Host Keys

SSH (Secure Shell) creates a secure communication channel primarily through public-key encryption. When an SSH client attempts to connect to an SSH server, the server first sends a copy of its public key to the client. The server's public key is important because the client uses this host key to authenticate the server's identity.

When you run the `ssh` command, your client checks for a record of the server's public key in its local known hosts file. This file can be centrally managed in /etc/ssh/ssh_known_hosts or, more commonly, stored in your user's home directory at ~/.ssh/known_hosts.

If your client already has a copy of the server's public key, then the `ssh` command compares the key that it received from the server with the locally stored one. If these keys do not match, then the client assumes a potential security risk, such as an interceptor or man-in-the-middle attack, and refuses to connect to the host. This strict verification process is a critical layer of security because it prevents your system from unknowingly connecting to a compromised or malicious server.

After the server's identity is successfully verified (or accepted by the user), the connection is deemed trustworthy enough to proceed to the next critical stage: the key exchange. During the key exchange (often by using the Diffie-Hellman method), a temporary, shared secret session key is generated for faster, symmetric encryption of all subsequent communications.

### Strict Host Key Checking on Clients

For security, the SSH client's default setting is to require manual confirmation before a new host key is accepted and stored.

```bash
ssh hostb
```

However, you can adjust this behavior by setting the StrictHostKeyChecking option, either in a configuration file or from the command line.

### Configure Host Key Checking with Configuration Files

You can customize how your SSH client handles host keys by editing one of two configuration files:

- The `/etc/ssh/ssh_config` file configures system-wide SSH client settings.
- The `~/.ssh/config` file configures user-specific SSH client settings.

Keep in mind that any settings in your personal `~/.ssh/config` file override those settings in the system-wide configuration.

To control how your SSH client handles host keys, modify the `StrictHostKeyChecking` parameter in your preferred configuration file. Set the parameter to one of these options

| Option      | Description |
|-------------|-------------|
| **yes**     | The most secure setting. The SSH client always ends the connection if the server's public key does not match the one stored in your `known_hosts` file. You must manually add new host keys to `known_hosts`, since SSH does not do it automatically. Highly secure, but can be inconvenient due to manual key management. |
| **accept-new** | Automatically adds new host keys to `known_hosts` when connecting to a new host. If a host's key has changed, the connection fails, preventing potential security risks. |
| **no**      | The least secure option. SSH automatically adds new host keys without prompting and allows connections even if a host's key has changed, which increases vulnerability to interceptor attacks. |
| **ask**     | The default and recommended setting. SSH prompts for confirmation before adding a new host key. If a host's key has changed, SSH refuses the connection and alerts you, preventing compromised connections. |


### Configure Host Key Checking from the Command Line

You can also set the `StrictHostKeyChecking` parameter from the command line by specifying the `-o StrictHostKeyChecking` option when you run the `ssh` command. The option uses the same settings as the configuration file parameter.

Command-line options always take precedence over settings in both your personal `~/.ssh/config` file and the system-wide `/etc/ssh/ssh_config` file. This precedence means that you can temporarily adjust host key checking behavior for a single connection without altering your permanent configuration.

For example, to connect to a new host and to automatically accept its host key (which is generally discouraged for security reasons unless you are certain of the host's authenticity), you could use the following command:

```bash
ssh -o StrictHostKeyChecking=accept-new hostb
```

## Verifying SSH Host Key Fingerprints

