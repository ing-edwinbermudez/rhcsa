# Controlling Services and Daemons

## The systemd Daemon

The `systemd` daemon manages the startup process for Linux, which includes starting services and managing services in general. The `systemd` daemon activates system resources, server daemons, and other processes, both at boot time and on a running system.

Daemons are processes that either wait or run in the background to perform various tasks. By convention, daemon names end with `d`, such as httpd, vsftpd, chronyd, and so on. In the context of systemd, a service often refers to one or more daemons.

Generally, daemons start automatically at boot time and continue to run until the system shuts down or until you manually stop them. However, starting or stopping a service might instead change the state of the system once, without leaving a running daemon process afterward (a oneshot service type).

In Red Hat Enterprise Linux, the first process that starts (PID 1) is the systemd daemon, which provides these features:
- Parallelization capabilities (starting multiple services simultaneously), which increase the boot speed of a system.
- On-demand starting of daemons without requiring a separate service.
- Automatic service dependency management, which can prevent long timeouts. For example, a network-dependent service does not try to start until the network is available.
- A method of tracking related processes together by using Linux control groups.

## Service Units Description

A systemd unit defines objects that the system knows how to manage.

Units are represented by configuration files named unit files, which encapsulate information about system services, listening sockets, and other relevant objects for the systemd init system.

A unit has a name and a unit type. The name provides a unique identity to the unit. The unit type enables grouping units together with other similar unit types.

The systemd daemon uses units to manage different types of objects:

**Service units**
Service units have a `.service` extension and represent system services. You can use service units to start frequently used daemons, such as a web server.

**Socket units**
Socket units have a `.socket` extension and represent interprocess communication (IPC) sockets that systemd should monitor. If a client connects to the socket, then the systemd manager start/s a daemon and passes the connection to it. You can use socket units to delay the start of a service at boot time and to start on demand the services that are used less often.

**Path units**
Path units have a `.path` extension and delay the activation of a service until a specific file-system change occurs. You can use path units for services that use spool directories, such as a printing system.

To manage units, use the `systemctl` command. For example, display available unit types with the `systemctl -t` help command. The `systemctl` command can take abbreviated unit names, process tree entries, and unit descriptions.

## Listing Service Units

Use the `systemctl` command to explore the system's current state. For example, the following command lists and paginates all currently loaded service units.

```bash
systemctl list-units --type=service
```

```bash
  UNIT                       LOAD   ACTIVE SUB          DESCRIPTION
  accounts-daemon.service    loaded active running      Accounts Service
  atd.service                loaded active running      Deferred execution ...
  auditd.service             loaded active running      Security Audit ...
  avahi-daemon.service       loaded active running      Avahi mDNS/DNS-SD Stack
  chronyd.service            loaded active running      NTP client/server
...output omitted...
```

In this example, the `--type=service` option limits the type of systemd units to service units. The output has the following columns:

- UNIT : The service unit name.
- LOAD : Whether the systemd daemon correctly parsed the unit's configuration and loaded the unit into memory.
- ACTIVE : The high-level activation state of the unit. This information indicates whether the unit started successfully.
- SUB : The low-level activation state of the unit. This information indicates more detailed information about the unit. The information varies based on unit type, state, and how the unit is executed.
- DESCRIPTION : The short description of the unit.

By default, the `systemctl list-units --type=service` command lists only the service units with active activation states. The `systemctl list-units --all` option lists all service units regardless of the activation states. Use the `--state=` option to filter by the values in the LOAD, ACTIVE, or SUB fields.

```bash
systemctl list-units --type=service --all
```

The `systemctl` command without any arguments lists units that are both loaded and active.

```bash
systemctl
```

The `systemctl` command `list-units` option displays units that the systemd service attempts to parse and load into memory. This option does not display services that are installed but not enabled. You can use the `systemctl` command `list-unit-files` option to see the state of all the installed unit files:

```bash
systemctl list-unit-files --type=service
```

In the output of the `systemctl list-unit-files` command, some common entries for the STATE field are enabled, `disabled`, `static`, and `masked`. All STATE values are listed in the systemctl command manual pages.

## Viewing Service States

View a unit's status with the `systemctl status name.type` command. If the unit type is omitted, then the command expects a service unit with that name.

```bash
systemctl status sshd.service
```

```bash
● sshd.service - OpenSSH server daemon
     Loaded: loaded (/usr/lib/systemd/system/sshd.service; enabled; preset: enabled)
     Active: active (running) since Thu 2025-05-22 14:47:33 UTC; 2h 48min ago
 Invocation: 215ee4e3b9e2426880cb727cb3933db1
       Docs: man:sshd(8)
             man:sshd_config(5)
   Main PID: 2212 (sshd)
      Tasks: 1 (limit: 35724)
     Memory: 3.2M (peak: 6.4M)
        CPU: 8.984s
     CGroup: /system.slice/sshd.service
             └─2212 "sshd: /usr/sbin/sshd -D [listener] 0 of 10-100 startups"

May 22 17:33:34 workstation sshd-session[5124]: Connection closed by ...
May 22 17:33:46 workstation sshd-session[5125]: Connection closed by ...
May 22 17:33:59 workstation sshd-session[5126]: Connection closed by ...
...output omitted...
```

The following table lists some output fields from the `systemctl` command status option:

**Service Unit Information**

| Field     | Description |
| --------- | ----------- |
| Loaded    | Whether the service unit is loaded into memory. |
| Active    | Whether the service unit is running, and if so, for how long. |
| Docs      | Where to find more information about the service. |
| Main PID  | The main process ID of the service, including the command name. |
| Status    | More information about the service. |
| Process   | More information about related processes. |
| CGroup    | More information about related control groups. |

Not all these fields are always present in the command output.

Keywords in the status output indicate the state of the service. The following table defines keywords for service states.



**Service States in `systemctl` Output**

| Keyword            | Description |
| ------------------ | ----------- |
| loaded             | The unit configuration file is processed. |
| active (running)   | The service is running with continuing processes. |
| active (exited)    | The service successfully completed a one-time configuration. |
| active (waiting)   | The service is running but is waiting for an event. |
| inactive           | The service is not running. |
| enabled            | The service starts at boot time. |
| disabled           | The service is not set to start at boot time. |
| static             | The service cannot be enabled, but an enabled unit might start it automatically. |


## Verifying Service Status

The `systemctl` command verifies the specific states of a service. For example, use the `systemctl` command `is-active` option to verify whether a service unit is active (running):

```bash
systemctl is-active sshd.service
```
The command returns the service unit state, which is usually `active` or `inactive`.

Run the `systemctl` command `is-enabled` option to verify whether a service unit is enabled to start automatically during system boot:

```bash
systemctl is-enabled sshd.service
```

The command returns whether the service unit is enabled to start at boot time, and the state is usually `enabled` or `disabled`.

To verify whether the unit failed during startup, run the `systemctl` command `is-failed` option:

```bash
systemctl is-failed sshd.service
```

The command returns `active` if the service is correctly `running`, or `failed` if an error occurred during startup. If the unit was stopped, then it returns `unknown` or `inactive`.

To list all the failed units, run the `systemctl --failed --type=service` command.

# Controlling System Services

## Starting and Stopping Services

You can manually `start`, `stop`, or `reload` services to update the service, update the configuration file, uninstall the service, or manually manage an infrequently used service.

To verify the status of a service, including whether the service is running or stopped, use the systemctl status command:

```bash
systemctl status sshd.service
```

To start a service, use the `systemctl start` command as the root user (with the sudo command if necessary). If you run the systemctl start command with the service name only (without the service type), then the systemd service looks for .service files.

```bash
systemctl start sshd
```

To stop a running service, use the systemctl command stop option. The following example stops the sshd.service service:

```bash
systemctl stop sshd.service
```

## Restarting and Reloading Services

When you restart a running service, the service first stops and then starts again. On the service restart, the new process gets a new ID during the startup and thus the process ID changes.

To restart a running service, use the `systemctl` command `restart` option. The following example restarts the sshd service:

```bash
systemctl restart sshd.service
```

Some services can reload their configuration files without requiring a restart, which is called a service reload. Reloading a service does not change the process ID that is associated with various service processes. To reload a running service, use the `systemctl` command `reload` option. The following example shows how to reload the sshd.service service after configuration changes:

```bash
systemctl reload sshd.service
```

If you are unsure whether the service has the function to reload the configuration file changes, use the `systemctl` command `reload-or-restart` option. The command reloads the configuration changes if the reloading function is available. Otherwise, the command restarts the service to implement the new configuration changes:

```bash
systemctl reload-or-restart sshd.service
```


## Listing Unit Dependencies

Some services require other services to be running first, which creates dependencies on the other services. Some services start only on demand, rather than at boot time. In both cases, the systemd and systemctl commands start services as needed, whether to resolve the dependency or to start an infrequently used service. Disabling the service disables the dependencies.

To view a hierarchy mapping of dependencies to start a service unit, use the systemctl list-dependencies UNIT command.

The following example lists dependencies for the sshd.service service:

```bash
systemctl list-dependencies sshd.service
```

To list reverse dependencies (units that depend on the specified unit), use the --reverse option with the command.

This example lists services that depend on the NetworkManager service:

```bash
systemctl list-dependencies --reverse NetworkManager.service
```

## Masking and Unmasking Services

At times, some installed services on your system might conflict with each other. For example, many ways exist to manage mail servers (the postfix and sendmail services). Masking a service prevents an administrator from accidentally starting a service that conflicts with other services. Masking creates a link in the configuration directories to the `/dev/null` file, which prevents the service from starting. To mask a service, use the systemctl command mask option.

```bash
systemctl mask sendmail.service
```

Then, verify the state of the service by using the systemctl list-unit-files command:

```bash
systemctl list-unit-files --type=service
```

Attempting to start a masked service unit fails with the following output:

```bash
systemctl start sendmail.service
```

Use the systemctl unmask command to unmask the service unit.

```bash
systemctl unmask sendmail
```

**Important**

You, or another unit file, can manually start a disabled service, but it does not start automatically at boot. A masked service does not start manually or automatically.

## Enabling Services to Start or Stop at Boot

Starting a service on a running system does not guarantee that the service automatically starts when the system reboots. Similarly, stopping a service on a running system does not prevent it from starting again when the system reboots. Creating links in the systemd configuration directories enables the service to start at boot. You can create or remove these links by using the `systemctl` command with the `enable` or `disable` option.

```bash
systemctl enable sshd.service
```

This command creates a symbolic link from the service unit file, usually in the `/usr/lib/systemd/system` directory, to the disk location where the systemd command looks for files, in the `/etc/systemd/system/TARGETNAME.target.wants` directory. Enabling a service does not start the service in the current session. To start the service and enable it to start automatically during boot, you can execute both the `systemctl start` and `systemctl enable` commands, or use the equivalent `systemctl enable --now` command.

```bash
systemctl enable --now sshd.service
```

To disable the service from starting automatically, use the systemctl disable command, which removes the symbolic link that was created when enabling a service. Disabling a service does not stop the service if it is currently running. To disable and stop a service, you can execute both the `systemctl stop` and `systemctl disable` commands, or use the equivalent `systemctl disable --now` command.

```bash
systemctl disable --now sshd.service
```

To verify whether the service is enabled or disabled, use the `systemctl is-enabled` command.

```bash
systemctl is-enabled sshd.service
```

## Summary of systemctl Commands

**Useful Service Management Commands**

| Command                       | Task                                                                                                 |
|--------------------------------|------------------------------------------------------------------------------------------------------|
| `systemctl status UNIT`        | View detailed information about a unit's state.                                                      |
| `systemctl stop UNIT`          | Stop a service on a running system.                                                                  |
| `systemctl start UNIT`         | Start a service on a running system.                                                                 |
| `systemctl restart UNIT`       | Restart a service on a running system.                                                               |
| `systemctl reload UNIT`        | Reload the configuration file of a running service.                                                  |
| `systemctl mask UNIT`          | Disable a service from being started, both manually and at boot.                                     |
| `systemctl unmask UNIT`        | Make available a masked service.                                                                     |
| `systemctl enable UNIT`        | Configure a service to start at boot time. Use the `--now` option to also start the service.         |
| `systemctl disable UNIT`       | Disable a service from starting at boot time. Use the `--now` option to also stop the service.       |

